"use strict";(self["webpackChunktest1"]=self["webpackChunktest1"]||[]).push([[219],{3173:function(t,e,a){var o=a(4373);const n=o.A.create({baseURL:"http://localhost:9091"});n.interceptors.request.use((t=>{const e=localStorage.getItem("jwt");return e&&(t.headers.Authorization=`Bearer ${e}`),t}),(t=>Promise.reject(t))),e.A=n},7219:function(t,e,a){a.r(e),a.d(e,{default:function(){return y}});var o=a(6768),n=a(4232);const s={class:"contentW"},l={key:0},c={key:1},r={class:"tbl"},d=["onClick"],i={class:"wd16"},u={class:"wd12"},k={class:"wd10"},h={class:"wd10"},m={key:0},E={class:"wd12"},I={class:"wd10"};function C(t,e,a,C,g,L){const v=(0,o.g2)("Pagination"),P=(0,o.g2)("ChatModal");return(0,o.uX)(),(0,o.CE)("div",s,[e[3]||(e[3]=(0,o.Lk)("ul",null,[(0,o.Lk)("li",{class:"tit"},"실시간 채팅 지원"),(0,o.Lk)("li",{class:"navi"},[(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"홈"),(0,o.Lk)("li",null,"실시간 채팅 지원")])])],-1)),0===C.chatrooms.length?((0,o.uX)(),(0,o.CE)("div",l,"실시간 채팅 지원이 없습니다.")):((0,o.uX)(),(0,o.CE)("div",c,[e[2]||(e[2]=(0,o.Lk)("h1",{class:"dpn"},"실시간 채팅 지원",-1)),(0,o.Lk)("table",r,[e[1]||(e[1]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("td",{class:"wd6"},"rId"),(0,o.Lk)("td",{class:"wd12"},"생성일"),(0,o.Lk)("td",{class:"wd10"},"답변자"),(0,o.Lk)("td",{class:"wd10"},"문의자"),(0,o.Lk)("td",null,"채팅"),(0,o.Lk)("td",{class:"wd12"},"마지막 채팅일"),(0,o.Lk)("td",{class:"wd10"},"상태(대기/진행중/완료)")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(C.chatrooms?.slice(C.pageStartIdx,C.pageStartIdx+C.ITEM_PER_PAGE),(t=>((0,o.uX)(),(0,o.CE)("tr",{key:t.chatroomId,onClick:e=>C.openChatModal(t.chatroomId)},[(0,o.Lk)("td",i,(0,n.v_)(t.chatroomId),1),(0,o.Lk)("td",u,(0,n.v_)(t.credt),1),(0,o.Lk)("td",k,(0,n.v_)(Array.isArray(t.adm)?t.adm.map((t=>t.nick)).join(", "):""),1),(0,o.Lk)("td",h,(0,n.v_)(t.usr?.nick||""),1),(0,o.Lk)("td",null,[(0,o.eW)((0,n.v_)(t.lastContent)+" ",1),null!=C.unreadCounts[t.chatroomId]?((0,o.uX)(),(0,o.CE)("p",m," ( "+(0,n.v_)(C.unreadCounts[t.chatroomId])+" ) ",1)):(0,o.Q3)("",!0)]),(0,o.Lk)("td",E,(0,n.v_)(t.lastCredt),1),(0,o.Lk)("td",I,(0,n.v_)(t.status),1)],8,d)))),128))])]),C.chatrooms.length>0?((0,o.uX)(),(0,o.Wv)(v,(0,o.v6)({key:0,list:C.chatrooms},{ITEM_PER_PAGE:C.ITEM_PER_PAGE,PAGE_PER_SECTION:C.PAGE_PER_SECTION},{onChangePage:C.onChangePage}),null,16,["list","onChangePage"])):(0,o.Q3)("",!0)])),(0,o.bF)(P,{modelValue:C.isModalVisible,"onUpdate:modelValue":e[0]||(e[0]=t=>C.isModalVisible=t),userId:C.userId,nick:C.nick,role:C.role,chatroomId:C.chatroomId},null,8,["modelValue","userId","nick","role","chatroomId"])])}var g=a(144),L=a(3173),v=a(5530),P=a(9383),_=a(1102),p=a(5897),A=a(7203),w={components:{ChatModal:v.A,Pagination:P.A},setup(){const t=(0,g.KR)(localStorage.getItem("adminId")),e=(0,g.KR)(localStorage.getItem("adminNick")),a=(0,g.KR)("ADM"),n=(0,g.KR)(!1),s=(0,p.L)(),l=(0,o.EW)((()=>s.chatList)),c=(0,o.EW)((()=>s.unreadCounts)),r=(0,g.KR)("");let d=null;const i=(0,g.KR)(_.y.ITEM_PER_PAGE),u=(0,g.KR)(_.y.PAGE_PER_SECTION);let k=(0,g.KR)(1);const h=(0,o.EW)((()=>(k.value-1)*i.value)),m=t=>{k.value=t},E=t=>{r.value=t,n.value=!0,s.markAsRead(t)},I=async()=>{try{const t=await L.A.post("/api/admin/chat/liveChatWaitingList",{});s.setChatList(t.data)}catch(t){console.error("Error fetching chat list:",t)}},C=()=>{let t=`ws://localhost:9090/ws/adminOnList?role=adm&nick=${e.value}`;d=new WebSocket(t),d.onopen=()=>{console.log("activeAdminChkSocket connection opened")},d.onmessage=t=>{console.log("activeAdminChkSocket got message");let e=JSON.parse(t.data);e.forEach((t=>{let e={chatroomId:t._id,id:t.usr.id,nick:t.usr.nick,credt:t.credt,content:t.usr.nick+"님이 입장하였습니다."};s.handleIncomingMessage(e)}))},d.onclose=()=>{console.log("activeAdminChkSocket connection closed")},d.onerror=t=>{console.error("activeAdminChkSocket error:",t)}};function v(t){return new Promise((e=>{t.readyState===WebSocket.OPEN?e():t.addEventListener("open",e,{once:!0})}))}return(0,o.sV)((async()=>{C(),await I();const t=(0,A.mn)();await v(t);const e=s.chatList.map((t=>t.chatroomId));e.forEach((t=>{const e={chatroomId:t,type:"REJOIN"};(0,A.wI)(e)}))})),(0,o.hi)((()=>{d&&d.close()})),{userId:t,nick:e,role:a,chatrooms:l,unreadCounts:c,chatroomId:r,isModalVisible:n,openChatModal:E,ITEM_PER_PAGE:i,PAGE_PER_SECTION:u,pageStartIdx:h,onChangePage:m}}},R=a(1241);const S=(0,R.A)(w,[["render",C]]);var y=S}}]);
//# sourceMappingURL=219.014e0c38.js.map