"use strict";(self["webpackChunktest1"]=self["webpackChunktest1"]||[]).push([[961],{6961:function(t,e,a){a.r(e),a.d(e,{default:function(){return S}});var n=a(6768),o=a(4232);const l={class:"contentW"},s={key:0},c={key:1},r={class:"tbl"},d=["onClick"],i={class:"wd16"},u={class:"wd12"},E={class:"wd10"},k={class:"wd10"},g={key:0},P={class:"wd12"},h={class:"wd10"};function C(t,e,a,C,m,I){const _=(0,n.g2)("Pagination"),v=(0,n.g2)("ChatModal");return(0,n.uX)(),(0,n.CE)("div",l,[e[3]||(e[3]=(0,n.Lk)("ul",null,[(0,n.Lk)("li",{class:"tit"},"실시간 채팅 지원"),(0,n.Lk)("li",{class:"navi"},[(0,n.Lk)("ul",null,[(0,n.Lk)("li",null,"홈"),(0,n.Lk)("li",null,"실시간 채팅 지원")])])],-1)),0===C.chatrooms.length?((0,n.uX)(),(0,n.CE)("div",s,"실시간 채팅 지원이 없습니다.")):((0,n.uX)(),(0,n.CE)("div",c,[e[2]||(e[2]=(0,n.Lk)("h1",{class:"dpn"},"실시간 채팅 지원",-1)),(0,n.Lk)("table",r,[e[1]||(e[1]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("td",{class:"wd6"},"rId"),(0,n.Lk)("td",{class:"wd12"},"생성일"),(0,n.Lk)("td",{class:"wd10"},"답변자"),(0,n.Lk)("td",{class:"wd10"},"문의자"),(0,n.Lk)("td",null,"채팅"),(0,n.Lk)("td",{class:"wd12"},"마지막 채팅일"),(0,n.Lk)("td",{class:"wd10"},"상태(대기/진행중/완료)")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(C.chatrooms?.slice(C.pageStartIdx,C.pageStartIdx+C.ITEM_PER_PAGE),(t=>((0,n.uX)(),(0,n.CE)("tr",{key:t.chatroomId,onClick:e=>C.openChatModal(t.chatroomId)},[(0,n.Lk)("td",i,(0,o.v_)(t.chatroomId),1),(0,n.Lk)("td",u,(0,o.v_)(t.credt),1),(0,n.Lk)("td",E,(0,o.v_)(Array.isArray(t.adm)?t.adm.map((t=>t.nick)).join(", "):""),1),(0,n.Lk)("td",k,(0,o.v_)(t.usr?.nick||""),1),(0,n.Lk)("td",null,[(0,n.eW)((0,o.v_)(t.lastContent)+" ",1),null!=C.unreadCounts[t.chatroomId]?((0,n.uX)(),(0,n.CE)("p",g," ( "+(0,o.v_)(C.unreadCounts[t.chatroomId])+" ) ",1)):(0,n.Q3)("",!0)]),(0,n.Lk)("td",P,(0,o.v_)(t.lastCredt),1),(0,n.Lk)("td",h,(0,o.v_)(t.status),1)],8,d)))),128))])]),C.chatrooms.length>0?((0,n.uX)(),(0,n.Wv)(_,(0,n.v6)({key:0,list:C.chatrooms},{ITEM_PER_PAGE:C.ITEM_PER_PAGE,PAGE_PER_SECTION:C.PAGE_PER_SECTION},{onChangePage:C.onChangePage}),null,16,["list","onChangePage"])):(0,n.Q3)("",!0)])),(0,n.bF)(v,{modelValue:C.isModalVisible,"onUpdate:modelValue":e[0]||(e[0]=t=>C.isModalVisible=t),userId:C.userId,nick:C.nick,role:C.role,chatroomId:C.chatroomId},null,8,["modelValue","userId","nick","role","chatroomId"])])}var m=a(144),I=a(3173),_=a(6598),v=a(9383),p=a(1102),L=a(5897),A=a(7203),R={components:{ChatModal:_.A,Pagination:v.A},setup(){const t=(0,m.KR)(localStorage.getItem("adminId")),e=(0,m.KR)(localStorage.getItem("adminNick")),a=(0,m.KR)("ADM"),o=(0,m.KR)(!1),l=(0,L.L)(),s=(0,n.EW)((()=>l.chatList)),c=(0,n.EW)((()=>l.unreadCounts)),r=(0,m.KR)("");let d=null;const i=(0,m.KR)(p.y.ITEM_PER_PAGE),u=(0,m.KR)(p.y.PAGE_PER_SECTION);let E=(0,m.KR)(1);const k=(0,n.EW)((()=>(E.value-1)*i.value)),g=t=>{E.value=t},P=t=>{r.value=t,o.value=!0,l.markAsRead(t)},h=async()=>{try{const t=await I.A.post("/api/admin/chat/liveChatWaitingList",{});l.setChatList(t.data)}catch(t){console.error("Error fetching livelist:",t)}},C=()=>{let t=`ws://localhost:9090/ws/adminOnList?role=adm&nick=${e.value}`;d=new WebSocket(t),d.onopen=()=>{console.log("activeAdminChkSocket connection opened")},d.onmessage=t=>{console.log("activeAdminChkSocket got message");let e=JSON.parse(t.data);e.forEach((t=>{let e={chatroomId:t._id,id:t.usr.id,nick:t.usr.nick,credt:t.credt,content:t.usr.nick+"님이 입장하였습니다."};l.handleIncomingMessage(e)}))},d.onclose=()=>{console.log("activeAdminChkSocket connection closed")},d.onerror=t=>{console.error("activeAdminChkSocket error:",t)}};function _(t){return new Promise((e=>{t.readyState===WebSocket.OPEN?e():t.addEventListener("open",e,{once:!0})}))}return(0,n.sV)((async()=>{C(),await h();const t=(0,A.mn)();await _(t);const e=l.chatList.map((t=>t.chatroomId));e.forEach((t=>{const e={chatroomId:t,type:"REJOIN"};(0,A.wI)(e)}))})),(0,n.hi)((()=>{d&&d.close()})),{userId:t,nick:e,role:a,chatrooms:s,unreadCounts:c,chatroomId:r,isModalVisible:o,openChatModal:P,ITEM_PER_PAGE:i,PAGE_PER_SECTION:u,pageStartIdx:k,onChangePage:g}}},f=a(1241);const y=(0,f.A)(R,[["render",C]]);var S=y},9383:function(t,e,a){a.d(e,{A:function(){return P}});var n=a(6768),o=a(4232);const l={style:{display:"flex","align-items":"center"}},s={key:0},c=["onClick"],r={key:1};function d(t,e,a,d,i,u){return(0,n.uX)(),(0,n.CE)("div",l,[t.leftmostPage>a.PAGE_PER_SECTION?((0,n.uX)(),(0,n.CE)("span",s,[(0,n.Lk)("a",{onClick:e[0]||(e[0]=()=>{t.leftmostPage-=a.PAGE_PER_SECTION,t.onChangeCurPage(t.leftmostPage)})},"<")])):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.getPaginationArray(t.leftmostPage),(e=>((0,n.uX)(),(0,n.CE)("span",{class:"page",key:e},[(0,n.Lk)("a",{class:(0,o.C4)({on:e===t.curPage}),onClick:()=>{t.onChangeCurPage(e)}},(0,o.v_)(e),11,c)])))),128)),t.leftmostPage+a.PAGE_PER_SECTION<=t.totalPage?((0,n.uX)(),(0,n.CE)("span",r,[(0,n.Lk)("a",{onClick:e[1]||(e[1]=()=>{t.leftmostPage+=a.PAGE_PER_SECTION,t.onChangeCurPage(t.leftmostPage)})},">")])):(0,n.Q3)("",!0)])}a(4114);var i=a(144),u={props:{list:Array,ITEM_PER_PAGE:Number,PAGE_PER_SECTION:Number},emits:["change-page"],setup(t,{emit:e}){return{...E(t,e)}}};const E=(t,e)=>{const a=(0,i.KR)(1),n=(0,i.KR)(1),o=Math.ceil(t.list.length/(t.ITEM_PER_PAGE||1)),l=e=>{const a=[];for(let n=e;n<Math.min(o+1,e+t.PAGE_PER_SECTION);n++)a.push(n);return a},s=t=>{a.value=t,e("change-page",t)};return{leftmostPage:n,curPage:a,totalPage:o,getPaginationArray:l,onChangeCurPage:s}};var k=a(1241);const g=(0,k.A)(u,[["render",d]]);var P=g}}]);
//# sourceMappingURL=961.8983d132.js.map