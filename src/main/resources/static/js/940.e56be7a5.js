"use strict";(self["webpackChunktest1"]=self["webpackChunktest1"]||[]).push([[940],{1940:function(t,a,e){e.r(a),e.d(a,{default:function(){return y}});var o=e(6768),l=e(4232);const n={class:"contentW"},s={class:"tbl"},r=["onClick"],c={class:"wd10"},u={class:"wd10"},d={key:0};function i(t,a,e,i,m,E){const g=(0,o.g2)("Pagination"),h=(0,o.g2)("ChatHistoryModal"),C=(0,o.g2)("ChatModal");return(0,o.uX)(),(0,o.CE)("div",n,[a[4]||(a[4]=(0,o.Lk)("ul",null,[(0,o.Lk)("li",{class:"tit"},"내 채팅"),(0,o.Lk)("li",{class:"navi"},[(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"홈"),(0,o.Lk)("li",null,"내 채팅")])])],-1)),(0,o.Lk)("div",null,[a[3]||(a[3]=(0,o.Lk)("h1",{class:"dpn"},"내 채팅",-1)),(0,o.Lk)("table",s,[a[2]||(a[2]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("td",{class:"wd6"},"rId"),(0,o.Lk)("td",{class:"wd12"},"생성일"),(0,o.Lk)("td",{class:"wd10"},"답변자"),(0,o.Lk)("td",{class:"wd10"},"문의자"),(0,o.Lk)("td",null,"채팅"),(0,o.Lk)("td",{class:"wd12"},"마지막 채팅일"),(0,o.Lk)("td",{class:"wd10"},"상태(대기/진행중/완료)")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.chatrooms?.slice(i.pageStartIdx,i.pageStartIdx+i.ITEM_PER_PAGE),(t=>((0,o.uX)(),(0,o.CE)("tr",{key:t.chatroomId,onClick:a=>"02"===t.status?i.openChatModal(t.chatroomId):i.openChatHistoryModal(t.chatroomId)},[(0,o.Lk)("td",null,(0,l.v_)(t.chatroomId),1),(0,o.Lk)("td",null,(0,l.v_)(t.credt),1),(0,o.Lk)("td",c,(0,l.v_)(Array.isArray(t.adm)?t.adm.map((t=>t.nick)).join(", "):""),1),(0,o.Lk)("td",u,(0,l.v_)(t.usr?.nick||""),1),(0,o.Lk)("td",null,[(0,o.eW)((0,l.v_)(t.lastContent)+" ",1),null!=i.unreadCounts[t.chatroomId]?((0,o.uX)(),(0,o.CE)("p",d," ( "+(0,l.v_)(i.unreadCounts[t.chatroomId])+" ) ",1)):(0,o.Q3)("",!0)]),(0,o.Lk)("td",null,(0,l.v_)(t.lastCredt),1),(0,o.Lk)("td",null,(0,l.v_)(t.status),1)],8,r)))),128))])]),i.chatrooms.length>0?((0,o.uX)(),(0,o.Wv)(g,(0,o.v6)({key:0,list:i.chatrooms},{ITEM_PER_PAGE:i.ITEM_PER_PAGE,PAGE_PER_SECTION:i.PAGE_PER_SECTION},{onChangePage:i.onChangePage}),null,16,["list","onChangePage"])):(0,o.Q3)("",!0)]),(0,o.bF)(h,{modalValue:i.isChatHistoryModalVisible,"onUpdate:modalValue":a[0]||(a[0]=t=>i.isChatHistoryModalVisible=t),chatroomId:i.chatroomId},null,8,["modalValue","chatroomId"]),(0,o.bF)(C,{modelValue:i.isModalVisible,"onUpdate:modelValue":a[1]||(a[1]=t=>i.isModalVisible=t),userId:i.userId,nick:i.nick,role:i.role,chatroomId:i.chatroomId},null,8,["modelValue","userId","nick","role","chatroomId"])])}var m=e(144),E=e(3173),g=e(3476),h=e(6598),C=e(9383),k=e(1102),P=e(5897),v=e(7203),p={components:{ChatHistoryModal:g.A,ChatModal:h.A,Pagination:C.A},setup(){const t=(0,m.KR)(localStorage.getItem("adminId")),a=(0,m.KR)(localStorage.getItem("adminNick")),e=(0,m.KR)("ADM"),l=(0,P.L)(),n=(0,o.EW)((()=>l.chatList)),s=(0,o.EW)((()=>l.unreadCounts)),r=(0,m.KR)(""),c=(0,m.KR)(!1),u=(0,m.KR)(!1),d=(0,m.KR)(k.y.ITEM_PER_PAGE),i=(0,m.KR)(k.y.PAGE_PER_SECTION);let g=(0,m.KR)(1);const h=(0,o.EW)((()=>(g.value-1)*d.value)),C=t=>{g.value=t},p=async()=>{try{const a=await E.A.post("/api/admin/chat/mylist",{id:t.value});l.setChatList(a.data)}catch(a){console.error("Error fetching mylist:",a),console.log(a)}},I=async t=>{r.value=t,await(0,o.dY)(),c.value=!0},_=t=>{r.value=t,u.value=!0,l.markAsRead(t)},y=()=>{r.value=""};function L(t){return new Promise((a=>{t.readyState===WebSocket.OPEN?a():t.addEventListener("open",a,{once:!0})}))}return(0,o.sV)((async()=>{await p();const t=(0,v.mn)();await L(t);const a=l.chatList.filter((t=>"02"===t.status)).map((t=>t.chatroomId));a.forEach((t=>{const a={chatroomId:t,type:"REJOIN"};(0,v.wI)(a)}))})),{userId:t,nick:a,role:e,chatrooms:n,unreadCounts:s,chatroomId:r,isChatHistoryModalVisible:c,isModalVisible:u,openChatHistoryModal:I,openChatModal:_,resetChatroomId:y,ITEM_PER_PAGE:d,PAGE_PER_SECTION:i,pageStartIdx:h,onChangePage:C}}},I=e(1241);const _=(0,I.A)(p,[["render",i]]);var y=_},9383:function(t,a,e){e.d(a,{A:function(){return h}});var o=e(6768),l=e(4232);const n={style:{display:"flex","align-items":"center"}},s={key:0},r=["onClick"],c={key:1};function u(t,a,e,u,d,i){return(0,o.uX)(),(0,o.CE)("div",n,[t.leftmostPage>e.PAGE_PER_SECTION?((0,o.uX)(),(0,o.CE)("span",s,[(0,o.Lk)("a",{onClick:a[0]||(a[0]=()=>{t.leftmostPage-=e.PAGE_PER_SECTION,t.onChangeCurPage(t.leftmostPage)})},"<")])):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(t.getPaginationArray(t.leftmostPage),(a=>((0,o.uX)(),(0,o.CE)("span",{class:"page",key:a},[(0,o.Lk)("a",{class:(0,l.C4)({on:a===t.curPage}),onClick:()=>{t.onChangeCurPage(a)}},(0,l.v_)(a),11,r)])))),128)),t.leftmostPage+e.PAGE_PER_SECTION<=t.totalPage?((0,o.uX)(),(0,o.CE)("span",c,[(0,o.Lk)("a",{onClick:a[1]||(a[1]=()=>{t.leftmostPage+=e.PAGE_PER_SECTION,t.onChangeCurPage(t.leftmostPage)})},">")])):(0,o.Q3)("",!0)])}e(4114);var d=e(144),i={props:{list:Array,ITEM_PER_PAGE:Number,PAGE_PER_SECTION:Number},emits:["change-page"],setup(t,{emit:a}){return{...m(t,a)}}};const m=(t,a)=>{const e=(0,d.KR)(1),o=(0,d.KR)(1),l=Math.ceil(t.list.length/(t.ITEM_PER_PAGE||1)),n=a=>{const e=[];for(let o=a;o<Math.min(l+1,a+t.PAGE_PER_SECTION);o++)e.push(o);return e},s=t=>{e.value=t,a("change-page",t)};return{leftmostPage:o,curPage:e,totalPage:l,getPaginationArray:n,onChangeCurPage:s}};var E=e(1241);const g=(0,E.A)(i,[["render",u]]);var h=g},3476:function(t,a,e){e.d(a,{A:function(){return m}});var o=e(6768),l=e(5130),n=e(4232);function s(t,a,e,s,r,c){return s.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-overlay",onClick:a[4]||(a[4]=(0,l.D$)(((...t)=>s.close&&s.close(...t)),["self"]))},[(0,o.Lk)("div",{class:"modal-content",ref:"modalContent",onMousedown:a[1]||(a[1]=(...t)=>s.startDrag&&s.startDrag(...t)),onMouseup:a[2]||(a[2]=(...t)=>s.stopDrag&&s.stopDrag(...t)),onMousemove:a[3]||(a[3]=(...t)=>s.drag&&s.drag(...t))},[(0,o.Lk)("button",{class:"modal-close",onClick:a[0]||(a[0]=(...t)=>s.close&&s.close(...t))},"×"),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.messages,((t,a)=>((0,o.uX)(),(0,o.CE)("div",{key:a},[(0,o.Lk)("p",null,(0,n.v_)(t.nick)+" : "+(0,n.v_)(t.content),1)])))),128))],544)])):(0,o.Q3)("",!0)}var r=e(144),c=e(3173),u={props:{modalValue:{type:Boolean,default:!1},chatroomId:{type:String,default:""}},emits:["update:modalValue","reset-chatroom-id"],setup(t,{emit:a}){const e=(0,o.EW)((()=>t.chatroomId)),l=(0,r.KR)(t.modalValue),n=(0,r.KR)(null);let s=(0,r.KR)(!1),u=0,d=0,i=0,m=0;const E=(0,r.KR)("");let g=(0,r.KR)([]);const h=async()=>{try{const t=await c.A.post("/api/chat/chatList",{chatroomId:e.value});g.value=t.data}catch(t){console.error("Error fetching modal history list:",t)}},C=()=>{e.value="",g.value=[],a("update:modalValue",!1),a("reset-chatroom-id")},k=t=>{s.value=!0,u=t.clientX,d=t.clientY;const a=n.value.getBoundingClientRect();i=a.left,m=a.top},P=()=>{s.value=!1},v=t=>{if(!s.value)return;const a=t.clientX-u,e=t.clientY-d;n.value.style.left=`${i+a}px`,n.value.style.top=`${m+e}px`};return(0,o.wB)((()=>t.modalValue),(t=>{l.value=t})),(0,o.wB)((()=>e.value),(t=>{t&&h()})),{chatroomId:e,visible:l,close:C,modalContent:n,startDrag:k,stopDrag:P,drag:v,message:E,messages:g}}},d=e(1241);const i=(0,d.A)(u,[["render",s],["__scopeId","data-v-891b615c"]]);var m=i}}]);
//# sourceMappingURL=940.e56be7a5.js.map