"use strict";(self["webpackChunktest1"]=self["webpackChunktest1"]||[]).push([[364],{9364:function(a,t,e){e.r(t),e.d(t,{default:function(){return y}});var o=e(6768),l=e(4232);const n={class:"contentW"},s={class:"tbl"},r=["onClick"],c={class:"wd10"},u={class:"wd10"},d={key:0};function i(a,t,e,i,m,E){const g=(0,o.g2)("Pagination"),h=(0,o.g2)("ChatHistoryModal"),C=(0,o.g2)("ChatModal");return(0,o.uX)(),(0,o.CE)("div",n,[t[4]||(t[4]=(0,o.Lk)("ul",null,[(0,o.Lk)("li",{class:"tit"},"내 채팅"),(0,o.Lk)("li",{class:"navi"},[(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"홈"),(0,o.Lk)("li",null,"내 채팅")])])],-1)),(0,o.Lk)("div",null,[t[3]||(t[3]=(0,o.Lk)("h1",{class:"dpn"},"내 채팅",-1)),(0,o.Lk)("table",s,[t[2]||(t[2]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("td",{class:"wd6"},"rId"),(0,o.Lk)("td",{class:"wd12"},"생성일"),(0,o.Lk)("td",{class:"wd10"},"답변자"),(0,o.Lk)("td",{class:"wd10"},"문의자"),(0,o.Lk)("td",null,"채팅"),(0,o.Lk)("td",{class:"wd12"},"마지막 채팅일"),(0,o.Lk)("td",{class:"wd10"},"상태(대기/진행중/완료)")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.chatrooms?.slice(i.pageStartIdx,i.pageStartIdx+i.ITEM_PER_PAGE),(a=>((0,o.uX)(),(0,o.CE)("tr",{key:a.chatroomId,onClick:t=>"02"===a.status?i.openChatModal(a.chatroomId):i.openChatHistoryModal(a.chatroomId)},[(0,o.Lk)("td",null,(0,l.v_)(a.chatroomId),1),(0,o.Lk)("td",null,(0,l.v_)(a.credt),1),(0,o.Lk)("td",c,(0,l.v_)(Array.isArray(a.adm)?a.adm.map((a=>a.nick)).join(", "):""),1),(0,o.Lk)("td",u,(0,l.v_)(a.usr?.nick||""),1),(0,o.Lk)("td",null,[(0,o.eW)((0,l.v_)(a.lastContent)+" ",1),null!=i.unreadCounts[a.chatroomId]?((0,o.uX)(),(0,o.CE)("p",d," ( "+(0,l.v_)(i.unreadCounts[a.chatroomId])+" ) ",1)):(0,o.Q3)("",!0)]),(0,o.Lk)("td",null,(0,l.v_)(a.lastCredt),1),(0,o.Lk)("td",null,(0,l.v_)(a.status),1)],8,r)))),128))])]),i.chatrooms.length>0?((0,o.uX)(),(0,o.Wv)(g,(0,o.v6)({key:0,list:i.chatrooms},{ITEM_PER_PAGE:i.ITEM_PER_PAGE,PAGE_PER_SECTION:i.PAGE_PER_SECTION},{onChangePage:i.onChangePage}),null,16,["list","onChangePage"])):(0,o.Q3)("",!0)]),(0,o.bF)(h,{modalValue:i.isChatHistoryModalVisible,"onUpdate:modalValue":t[0]||(t[0]=a=>i.isChatHistoryModalVisible=a),chatroomId:i.chatroomId},null,8,["modalValue","chatroomId"]),(0,o.bF)(C,{modelValue:i.isModalVisible,"onUpdate:modelValue":t[1]||(t[1]=a=>i.isModalVisible=a),userId:i.userId,nick:i.nick,role:i.role,chatroomId:i.chatroomId},null,8,["modelValue","userId","nick","role","chatroomId"])])}var m=e(144),E=e(3173),g=e(9990),h=e(4761),C=e(9383),k=e(1102),P=e(5897),v=e(7203),p={components:{ChatHistoryModal:g.A,ChatModal:h.A,Pagination:C.A},setup(){const a=(0,m.KR)(localStorage.getItem("adminId")),t=(0,m.KR)(localStorage.getItem("adminNick")),e=(0,m.KR)("ADM"),l=(0,P.L)(),n=(0,o.EW)((()=>l.chatList.filter((t=>Array.isArray(t.adm)&&t.adm.some((t=>t.id===a.value)))))),s=(0,o.EW)((()=>l.unreadCounts)),r=(0,m.KR)(""),c=(0,m.KR)(!1),u=(0,m.KR)(!1),d=(0,m.KR)(k.y_.ITEM_PER_PAGE),i=(0,m.KR)(k.y_.PAGE_PER_SECTION);let g=(0,m.KR)(1);const h=(0,o.EW)((()=>(g.value-1)*d.value)),C=a=>{g.value=a},p=async()=>{try{const t=await E.A.post("/api/admin/chat/mylist",{id:a.value});l.setChatList(t.data)}catch(t){console.error("Error fetching mylist:",t)}},I=async a=>{r.value=a,await(0,o.dY)(),c.value=!0},_=a=>{r.value=a,u.value=!0,l.markAsRead(a)},y=()=>{r.value=""};function L(a){return new Promise((t=>{a.readyState===WebSocket.OPEN?t():a.addEventListener("open",t,{once:!0})}))}return(0,o.sV)((async()=>{await p();const a=(0,v.mn)();await L(a);const t=l.chatList.filter((a=>"02"===a.status)).map((a=>a.chatroomId));t.forEach((a=>{const t={chatroomId:a,type:"REJOIN"};(0,v.wI)(t)}))})),{userId:a,nick:t,role:e,chatrooms:n,unreadCounts:s,chatroomId:r,isChatHistoryModalVisible:c,isModalVisible:u,openChatHistoryModal:I,openChatModal:_,resetChatroomId:y,ITEM_PER_PAGE:d,PAGE_PER_SECTION:i,pageStartIdx:h,onChangePage:C}}},I=e(1241);const _=(0,I.A)(p,[["render",i]]);var y=_},9383:function(a,t,e){e.d(t,{A:function(){return h}});var o=e(6768),l=e(4232);const n={style:{display:"flex","align-items":"center"}},s={key:0},r=["onClick"],c={key:1};function u(a,t,e,u,d,i){return(0,o.uX)(),(0,o.CE)("div",n,[a.leftmostPage>e.PAGE_PER_SECTION?((0,o.uX)(),(0,o.CE)("span",s,[(0,o.Lk)("a",{onClick:t[0]||(t[0]=()=>{a.leftmostPage-=e.PAGE_PER_SECTION,a.onChangeCurPage(a.leftmostPage)})},"<")])):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.getPaginationArray(a.leftmostPage),(t=>((0,o.uX)(),(0,o.CE)("span",{class:"page",key:t},[(0,o.Lk)("a",{class:(0,l.C4)({on:t===a.curPage}),onClick:()=>{a.onChangeCurPage(t)}},(0,l.v_)(t),11,r)])))),128)),a.leftmostPage+e.PAGE_PER_SECTION<=a.totalPage?((0,o.uX)(),(0,o.CE)("span",c,[(0,o.Lk)("a",{onClick:t[1]||(t[1]=()=>{a.leftmostPage+=e.PAGE_PER_SECTION,a.onChangeCurPage(a.leftmostPage)})},">")])):(0,o.Q3)("",!0)])}e(4114);var d=e(144),i={props:{list:Array,ITEM_PER_PAGE:Number,PAGE_PER_SECTION:Number},emits:["change-page"],setup(a,{emit:t}){return{...m(a,t)}}};const m=(a,t)=>{const e=(0,d.KR)(1),o=(0,d.KR)(1),l=Math.ceil(a.list.length/(a.ITEM_PER_PAGE||1)),n=t=>{const e=[];for(let o=t;o<Math.min(l+1,t+a.PAGE_PER_SECTION);o++)e.push(o);return e},s=a=>{e.value=a,t("change-page",a)};return{leftmostPage:o,curPage:e,totalPage:l,getPaginationArray:n,onChangeCurPage:s}};var E=e(1241);const g=(0,E.A)(i,[["render",u]]);var h=g},9990:function(a,t,e){e.d(t,{A:function(){return m}});var o=e(6768),l=e(5130),n=e(4232);function s(a,t,e,s,r,c){return s.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"modal-overlay",onClick:t[4]||(t[4]=(0,l.D$)(((...a)=>s.close&&s.close(...a)),["self"]))},[(0,o.Lk)("div",{class:"modal-content",ref:"modalContent",onMousedown:t[1]||(t[1]=(...a)=>s.startDrag&&s.startDrag(...a)),onMouseup:t[2]||(t[2]=(...a)=>s.stopDrag&&s.stopDrag(...a)),onMousemove:t[3]||(t[3]=(...a)=>s.drag&&s.drag(...a))},[(0,o.Lk)("button",{class:"modal-close",onClick:t[0]||(t[0]=(...a)=>s.close&&s.close(...a))},"×"),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.messages,((a,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t},[(0,o.Lk)("p",null,(0,n.v_)(a.nick)+" : "+(0,n.v_)(a.content),1)])))),128))],544)])):(0,o.Q3)("",!0)}var r=e(144),c=e(3173),u={props:{modalValue:{type:Boolean,default:!1},chatroomId:{type:String,default:""}},emits:["update:modalValue","reset-chatroom-id"],setup(a,{emit:t}){const e=(0,o.EW)((()=>a.chatroomId)),l=(0,r.KR)(a.modalValue),n=(0,r.KR)(null);let s=(0,r.KR)(!1),u=0,d=0,i=0,m=0;const E=(0,r.KR)("");let g=(0,r.KR)([]);const h=async()=>{try{const a=await c.A.post("/api/chat/chatList",{chatroomId:e.value});g.value=a.data}catch(a){console.error("Error fetching modal history list:",a)}},C=()=>{e.value="",g.value=[],t("update:modalValue",!1),t("reset-chatroom-id")},k=a=>{s.value=!0,u=a.clientX,d=a.clientY;const t=n.value.getBoundingClientRect();i=t.left,m=t.top},P=()=>{s.value=!1},v=a=>{if(!s.value)return;const t=a.clientX-u,e=a.clientY-d;n.value.style.left=`${i+t}px`,n.value.style.top=`${m+e}px`};return(0,o.wB)((()=>a.modalValue),(a=>{l.value=a})),(0,o.wB)((()=>e.value),(a=>{a&&h()})),{chatroomId:e,visible:l,close:C,modalContent:n,startDrag:k,stopDrag:P,drag:v,message:E,messages:g}}},d=e(1241);const i=(0,d.A)(u,[["render",s]]);var m=i}}]);
//# sourceMappingURL=364.f3913023.js.map