{"version":3,"file":"js/111.c65eeae0.js","mappings":"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","sources":["webpack://test1/./src/axios.js","webpack://test1/./src/admin/modules/components/chat/MyChatManage.vue","webpack://test1/./src/admin/modules/components/chat/MyChatManage.vue?fd2b"],"sourcesContent":["import axios from \"axios\";\r\n\r\nconst instance = axios.create({\r\n  baseURL: \"http://localhost:9091\", // 로컬 프론트에서 돌릴때\r\n  //baseURL: \"http://localhost:9090\", // 로컬 백엔드에서 돌릴때\r\n  //baseURL: \"https://oral-therine-heesu-f4935ad1.koyeb.app\", // 백엔드 서버 주소\r\n});\r\n\r\ninstance.interceptors.request.use(\r\n  (config) => {\r\n    const token = localStorage.getItem(\"jwt\");\r\n    if (token) {\r\n      config.headers.Authorization = `Bearer ${token}`;\r\n    }\r\n    return config;\r\n  },\r\n  (error) => {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default instance;\r\n","<template>\r\n  <div class=\"contentW\">\r\n    <ul>\r\n      <li class=\"tit\">내 채팅</li>\r\n      <li class=\"navi\">\r\n        <ul>\r\n          <li>홈</li>\r\n          <li>내 채팅</li>\r\n        </ul>\r\n      </li>\r\n    </ul>\r\n    <div>\r\n      <h1 class=\"dpn\">내 채팅</h1>\r\n      <table class=\"tbl\">\r\n        <thead>\r\n          <tr>\r\n            <td class=\"wd6\">rId</td>\r\n            <td class=\"wd12\">생성일</td>\r\n            <td class=\"wd10\">답변자</td>\r\n            <td class=\"wd10\">문의자</td>\r\n            <td>채팅</td>\r\n            <td class=\"wd12\">마지막 채팅일</td>\r\n            <td class=\"wd10\">상태(대기/진행중/완료)</td>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr\r\n            v-for=\"chat in chatrooms?.slice(\r\n              pageStartIdx,\r\n              pageStartIdx + ITEM_PER_PAGE\r\n            )\"\r\n            :key=\"chat.chatroomId\"\r\n            @click=\"\r\n              chat.status === '02'\r\n                ? openChatModal(chat.chatroomId)\r\n                : openChatHistoryModal(chat.chatroomId)\r\n            \"\r\n          >\r\n            <td>{{ chat.chatroomId }}</td>\r\n            <td>{{ chat.credt }}</td>\r\n            <td class=\"wd10\">{{ chat.adm?.nick || \"\" }}</td>\r\n            <td class=\"wd10\">{{ chat.usr?.nick || \"\" }}</td>\r\n            <td>\r\n              {{ chat.lastContent }}\r\n              <p v-if=\"unreadCounts[chat.chatroomId] != null\">\r\n                ( {{ unreadCounts[chat.chatroomId] }} )\r\n              </p>\r\n            </td>\r\n            <td>{{ chat.lastCredt }}</td>\r\n            <td>{{ chat.status }}</td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n      <Pagination\r\n        v-if=\"chatrooms.length > 0\"\r\n        :list=\"chatrooms\"\r\n        v-bind=\"{ ITEM_PER_PAGE, PAGE_PER_SECTION }\"\r\n        @change-page=\"onChangePage\"\r\n      />\r\n    </div>\r\n    <ChatHistoryModal\r\n      v-model:modalValue=\"isChatHistoryModalVisible\"\r\n      :chatroomId=\"chatroomId\"\r\n    />\r\n    <ChatModal\r\n      v-model:modelValue=\"isModalVisible\"\r\n      :userId=\"userId\"\r\n      :nick=\"nick\"\r\n      :role=\"role\"\r\n      :chatroomId=\"chatroomId\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, computed } from \"vue\";\r\nimport axios from \"@/axios.js\";\r\nimport ChatHistoryModal from \"../../../../user/modules/components/chat/ChatHistoryModal.vue\";\r\nimport ChatModal from \"../../../../user/modules/components/chat/ChatModal.vue\";\r\nimport Pagination from \"@/common/Pagination.vue\";\r\nimport { useChatStore } from \"@/stores/chatStore\";\r\nimport { sendWebSocket, getWebSocket } from \"@/common/WebsocketManager\";\r\n\r\nexport default {\r\n  components: { ChatHistoryModal, ChatModal, Pagination },\r\n  setup() {\r\n    const userId = ref(localStorage.getItem(\"adminId\"));\r\n    const nick = ref(localStorage.getItem(\"adminNick\"));\r\n    const role = ref(\"ADM\");\r\n    const chatStore = useChatStore();\r\n    const chatrooms = computed(() => chatStore.chatList);\r\n    const unreadCounts = computed(() => chatStore.unreadCounts);\r\n    const chatroomId = ref(\"\");\r\n    const isChatHistoryModalVisible = ref(false);\r\n    const isModalVisible = ref(false);\r\n    /* 페이징 관련 */\r\n    const ITEM_PER_PAGE = ref(5);\r\n    const PAGE_PER_SECTION = ref(5);\r\n    let curPage = ref(1);\r\n\r\n    const pageStartIdx = computed(() => {\r\n      return (curPage.value - 1) * ITEM_PER_PAGE.value;\r\n    });\r\n\r\n    const onChangePage = (data) => {\r\n      curPage.value = data;\r\n    };\r\n\r\n    // 채팅 리스트 가져오기 함수\r\n    const getMyChatroomList = async () => {\r\n      try {\r\n        const response = await axios.post(\"/api/admin/chat/mylist\", {\r\n          id: userId.value,\r\n        });\r\n        //chatrooms.value = response.data;\r\n        // pinia\r\n        chatStore.setChatList(response.data);\r\n      } catch (error) {\r\n        console.error(\"Error fetching chat list:\", error);\r\n        console.log(error);\r\n      }\r\n    };\r\n\r\n    // 채팅창 열기\r\n    const openChatHistoryModal = (id) => {\r\n      chatroomId.value = id;\r\n      isChatHistoryModalVisible.value = true;\r\n    };\r\n\r\n    const openChatModal = (id) => {\r\n      chatroomId.value = id;\r\n      isModalVisible.value = true;\r\n      chatStore.markAsRead(id);\r\n    };\r\n\r\n    const resetChatroomId = () => {\r\n      chatroomId.value = \"\";\r\n    };\r\n\r\n    function waitWebSocketOpen(socket) {\r\n      return new Promise((resolve) => {\r\n        if (socket.readyState === WebSocket.OPEN) {\r\n          resolve();\r\n        } else {\r\n          socket.addEventListener(\"open\", resolve, { once: true });\r\n        }\r\n      });\r\n    }\r\n\r\n    onMounted(async () => {\r\n      // 리스트 최신화\r\n      await getMyChatroomList();\r\n      // 채팅방 복구\r\n      const socket = getWebSocket();\r\n      await waitWebSocketOpen(socket);\r\n\r\n      const rids = chatStore.chatList\r\n        .filter((r) => r.status === \"02\")\r\n        .map((r) => r.chatroomId);\r\n\r\n      rids.forEach((rid) => {\r\n        const sendBody = {\r\n          chatroomId: rid,\r\n          type: \"REJOIN\",\r\n        };\r\n        sendWebSocket(sendBody);\r\n      });\r\n    });\r\n\r\n    return {\r\n      userId,\r\n      nick,\r\n      role,\r\n      chatrooms,\r\n      unreadCounts,\r\n      chatroomId,\r\n      isChatHistoryModalVisible,\r\n      isModalVisible,\r\n      openChatHistoryModal,\r\n      openChatModal,\r\n      resetChatroomId,\r\n      ITEM_PER_PAGE,\r\n      PAGE_PER_SECTION,\r\n      pageStartIdx,\r\n      onChangePage,\r\n    };\r\n  },\r\n};\r\n</script>\r\n","import { render } from \"./MyChatManage.vue?vue&type=template&id=26e942ec\"\nimport script from \"./MyChatManage.vue?vue&type=script&lang=js\"\nexport * from \"./MyChatManage.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["instance","axios","create","baseURL","interceptors","request","use","config","token","localStorage","getItem","headers","Authorization","error","Promise","reject","class","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_Fragment","_renderList","$setup","chatrooms","slice","pageStartIdx","ITEM_PER_PAGE","chat","key","chatroomId","onClick","$event","status","openChatModal","openChatHistoryModal","_toDisplayString","credt","_hoisted_4","adm","nick","_hoisted_5","usr","lastContent","unreadCounts","_hoisted_6","lastCredt","length","_createBlock","_component_Pagination","_mergeProps","list","PAGE_PER_SECTION","onChangePage","_createVNode","_component_ChatHistoryModal","modalValue","isChatHistoryModalVisible","_component_ChatModal","modelValue","isModalVisible","userId","role","components","ChatHistoryModal","ChatModal","Pagination","setup","ref","chatStore","useChatStore","computed","chatList","curPage","value","data","getMyChatroomList","async","response","post","id","setChatList","console","log","markAsRead","resetChatroomId","waitWebSocketOpen","socket","resolve","readyState","WebSocket","OPEN","addEventListener","once","onMounted","getWebSocket","rids","filter","r","map","forEach","rid","sendBody","type","sendWebSocket","__exports__","render"],"sourceRoot":""}