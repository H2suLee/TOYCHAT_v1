{"version":3,"file":"js/206.a15816bb.js","mappings":"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","sources":["webpack://test1/./src/admin/modules/components/chat/ChatService.vue","webpack://test1/./src/admin/modules/components/chat/ChatService.vue?d985"],"sourcesContent":["<template>\r\n  <div class=\"contentW\">\r\n    <ul>\r\n      <li class=\"tit\">실시간 채팅 지원</li>\r\n      <li class=\"navi\">\r\n        <ul>\r\n          <li>홈</li>\r\n          <li>실시간 채팅 지원</li>\r\n        </ul>\r\n      </li>\r\n    </ul>\r\n    <div v-if=\"chatrooms.length === 0\">실시간 채팅 지원이 없습니다.</div>\r\n    <div v-else>\r\n      <h1 class=\"dpn\">실시간 채팅 지원</h1>\r\n      <table class=\"tbl\">\r\n        <!-- 내용, 날짜, 상태 -->\r\n        <tbody>\r\n          <tr\r\n            v-for=\"chat in chatrooms?.slice(\r\n              pageStartIdx,\r\n              pageStartIdx + ITEM_PER_PAGE\r\n            )\"\r\n            :key=\"chat.chatroomId\"\r\n            @click=\"openChatModal(chat._id)\"\r\n          >\r\n            <td class=\"wd12\">rid: {{ chat._id }}</td>\r\n            <td class=\"wd12\">닉: {{ chat.participants[0].nick }}</td>\r\n            <td class=\"wd12\">생성일: {{ chat.credt }}</td>\r\n            <td class=\"wd12\">상태: {{ chat.status }}</td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n      <Pagination\r\n        v-if=\"chatrooms.length > 0\"\r\n        :list=\"chatrooms\"\r\n        v-bind=\"{ ITEM_PER_PAGE, PAGE_PER_SECTION }\"\r\n        @change-page=\"onChangePage\"\r\n      />\r\n    </div>\r\n    <ChatModal\r\n      v-model:modelValue=\"isModalVisible\"\r\n      :userId=\"userId\"\r\n      :nick=\"nick\"\r\n      :role=\"role\"\r\n      :chatroomId=\"chatroomId\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, onUnmounted, computed } from \"vue\";\r\nimport axios from \"axios\";\r\nimport ChatModal from \"../../../../user/modules/components/chat/ChatModal.vue\";\r\nimport Pagination from \"../../../../user/modules/components/common/Pagination.vue\";\r\nexport default {\r\n  components: { ChatModal, Pagination },\r\n  setup() {\r\n    const userId = ref(localStorage.getItem(\"adminId\"));\r\n    const nick = ref(localStorage.getItem(\"adminNick\"));\r\n    const role = ref(\"ADM\");\r\n    const isModalVisible = ref(false);\r\n    const chatroomId = ref(\"\");\r\n    const chatrooms = ref([]);\r\n    let activeAdminChkSocket = null;\r\n\r\n    /* 페이징 관련 */\r\n    const ITEM_PER_PAGE = ref(20);\r\n    const PAGE_PER_SECTION = ref(10);\r\n    let curPage = ref(1);\r\n\r\n    const pageStartIdx = computed(() => {\r\n      return (curPage.value - 1) * ITEM_PER_PAGE.value;\r\n    });\r\n\r\n    const onChangePage = (data) => {\r\n      curPage.value = data;\r\n    };\r\n\r\n    const openChatModal = (id) => {\r\n      chatroomId.value = id;\r\n      isModalVisible.value = true;\r\n    };\r\n\r\n    const getLiveChatWaitingList = async () => {\r\n      try {\r\n        const response = await axios.post(\r\n          \"/api/admin/chat/liveChatWaitingList\",\r\n          {\r\n            //id: userId.value,\r\n          }\r\n        );\r\n\r\n        chatrooms.value = response.data;\r\n      } catch (error) {\r\n        console.error(\"Error fetching chat list:\", error);\r\n      }\r\n    };\r\n\r\n    const openActiveAdminChkSocket = () => {\r\n      let url = `ws://localhost:9090/ws/adminOnList?role=adm&nick=${nick.value}`;\r\n      activeAdminChkSocket = new WebSocket(url);\r\n\r\n      activeAdminChkSocket.onopen = () => {\r\n        console.log(\"activeAdminChkSocket connection opened\");\r\n      };\r\n\r\n      activeAdminChkSocket.onmessage = (event) => {\r\n        console.log(\"activeAdminChkSocket got message\");\r\n        chatrooms.value = [];\r\n        let jsonArr = JSON.parse(event.data);\r\n        jsonArr.forEach((item) => {\r\n          let jsonObj = {\r\n            _id: item._id,\r\n            participants: item.participants,\r\n            credt: item.credt,\r\n            status: item.status,\r\n          };\r\n          chatrooms.value.push(jsonObj);\r\n        });\r\n      };\r\n\r\n      activeAdminChkSocket.onclose = () => {\r\n        console.log(\"activeAdminChkSocket connection closed\");\r\n      };\r\n\r\n      activeAdminChkSocket.onerror = (error) => {\r\n        console.error(\"activeAdminChkSocket error:\", error);\r\n      };\r\n    };\r\n    onMounted(() => {\r\n      // 웹소켓 연결\r\n      openActiveAdminChkSocket();\r\n      // 실시간 상담 대기 리스트\r\n      getLiveChatWaitingList();\r\n    });\r\n\r\n    // 다른 페이지로 이동시 웹소켓 close\r\n    onUnmounted(() => {\r\n      if (activeAdminChkSocket) {\r\n        activeAdminChkSocket.close();\r\n      }\r\n    });\r\n\r\n    return {\r\n      userId,\r\n      nick,\r\n      role,\r\n      chatrooms,\r\n      chatroomId,\r\n      isModalVisible,\r\n      openChatModal,\r\n      ITEM_PER_PAGE,\r\n      PAGE_PER_SECTION,\r\n      pageStartIdx,\r\n      onChangePage,\r\n    };\r\n  },\r\n};\r\n</script>\r\n","import { render } from \"./ChatService.vue?vue&type=template&id=32293a75\"\nimport script from \"./ChatService.vue?vue&type=script&lang=js\"\nexport * from \"./ChatService.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","_createElementVNode","key","_createElementBlock","_hoisted_1","_hoisted_2","$setup","chatrooms","length","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_Fragment","_renderList","slice","pageStartIdx","ITEM_PER_PAGE","chat","chatroomId","onClick","$event","openChatModal","_id","_hoisted_8","_toDisplayString","_hoisted_9","participants","nick","_hoisted_10","credt","_hoisted_11","status","_hoisted_7","_createBlock","_component_Pagination","_mergeProps","list","PAGE_PER_SECTION","onChangePage","_createCommentVNode","_createVNode","_component_ChatModal","modelValue","isModalVisible","_cache","userId","role","components","ChatModal","Pagination","setup","ref","localStorage","getItem","activeAdminChkSocket","curPage","computed","value","data","id","getLiveChatWaitingList","async","response","axios","post","error","console","openActiveAdminChkSocket","url","WebSocket","onopen","log","onmessage","event","jsonArr","JSON","parse","forEach","item","jsonObj","push","onclose","onerror","onMounted","onUnmounted","close","__exports__","render"],"sourceRoot":""}