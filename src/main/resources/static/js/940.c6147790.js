"use strict";(self["webpackChunktest1"]=self["webpackChunktest1"]||[]).push([[940],{1940:function(a,t,l){l.r(t),l.d(t,{default:function(){return p}});var o=l(6768),e=l(4232);const s={class:"contentW"},n={class:"tbl"},d=["onClick"],r={class:"wd10"},c={class:"wd10"},i={key:0};function u(a,t,l,u,h,k){const m=(0,o.g2)("Pagination"),E=(0,o.g2)("ChatHistoryModal"),I=(0,o.g2)("ChatModal");return(0,o.uX)(),(0,o.CE)("div",s,[t[4]||(t[4]=(0,o.Lk)("ul",null,[(0,o.Lk)("li",{class:"tit"},"내 채팅"),(0,o.Lk)("li",{class:"navi"},[(0,o.Lk)("ul",null,[(0,o.Lk)("li",null,"홈"),(0,o.Lk)("li",null,"내 채팅")])])],-1)),(0,o.Lk)("div",null,[t[3]||(t[3]=(0,o.Lk)("h1",{class:"dpn"},"내 채팅",-1)),(0,o.Lk)("table",n,[t[2]||(t[2]=(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[(0,o.Lk)("td",{class:"wd6"},"rId"),(0,o.Lk)("td",{class:"wd12"},"생성일"),(0,o.Lk)("td",{class:"wd10"},"답변자"),(0,o.Lk)("td",{class:"wd10"},"문의자"),(0,o.Lk)("td",null,"채팅"),(0,o.Lk)("td",{class:"wd12"},"마지막 채팅일"),(0,o.Lk)("td",{class:"wd10"},"상태(대기/진행중/완료)")])],-1)),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(u.chatrooms?.slice(u.pageStartIdx,u.pageStartIdx+u.ITEM_PER_PAGE),(a=>((0,o.uX)(),(0,o.CE)("tr",{key:a.chatroomId,onClick:t=>"02"===a.status?u.openChatModal(a.chatroomId):u.openChatHistoryModal(a.chatroomId)},[(0,o.Lk)("td",null,(0,e.v_)(a.chatroomId),1),(0,o.Lk)("td",null,(0,e.v_)(a.credt),1),(0,o.Lk)("td",r,(0,e.v_)(Array.isArray(a.adm)?a.adm.map((a=>a.nick)).join(", "):""),1),(0,o.Lk)("td",c,(0,e.v_)(a.usr?.nick||""),1),(0,o.Lk)("td",null,[(0,o.eW)((0,e.v_)(a.lastContent)+" ",1),null!=u.unreadCounts[a.chatroomId]?((0,o.uX)(),(0,o.CE)("p",i," ( "+(0,e.v_)(u.unreadCounts[a.chatroomId])+" ) ",1)):(0,o.Q3)("",!0)]),(0,o.Lk)("td",null,(0,e.v_)(a.lastCredt),1),(0,o.Lk)("td",null,(0,e.v_)(a.status),1)],8,d)))),128))])]),u.chatrooms.length>0?((0,o.uX)(),(0,o.Wv)(m,(0,o.v6)({key:0,list:u.chatrooms},{ITEM_PER_PAGE:u.ITEM_PER_PAGE,PAGE_PER_SECTION:u.PAGE_PER_SECTION},{onChangePage:u.onChangePage}),null,16,["list","onChangePage"])):(0,o.Q3)("",!0)]),(0,o.bF)(E,{modalValue:u.isChatHistoryModalVisible,"onUpdate:modalValue":t[0]||(t[0]=a=>u.isChatHistoryModalVisible=a),chatroomId:u.chatroomId},null,8,["modalValue","chatroomId"]),(0,o.bF)(I,{modelValue:u.isModalVisible,"onUpdate:modelValue":t[1]||(t[1]=a=>u.isModalVisible=a),userId:u.userId,nick:u.nick,role:u.role,chatroomId:u.chatroomId},null,8,["modelValue","userId","nick","role","chatroomId"])])}var h=l(144),k=l(3173),m=l(3476),E=l(6598),I=l(9383),C=l(1102),L=l(5897),v=l(7203),P={components:{ChatHistoryModal:m.A,ChatModal:E.A,Pagination:I.A},setup(){const a=(0,h.KR)(localStorage.getItem("adminId")),t=(0,h.KR)(localStorage.getItem("adminNick")),l=(0,h.KR)("ADM"),e=(0,L.L)(),s=(0,o.EW)((()=>e.chatList)),n=(0,o.EW)((()=>e.unreadCounts)),d=(0,h.KR)(""),r=(0,h.KR)(!1),c=(0,h.KR)(!1),i=(0,h.KR)(C.y.ITEM_PER_PAGE),u=(0,h.KR)(C.y.PAGE_PER_SECTION);let m=(0,h.KR)(1);const E=(0,o.EW)((()=>(m.value-1)*i.value)),I=a=>{m.value=a},P=async()=>{try{const t=await k.A.post("/api/admin/chat/mylist",{id:a.value});e.setChatList(t.data)}catch(t){console.error("Error fetching mylist:",t),console.log(t)}},_=async a=>{d.value=a,await(0,o.dY)(),r.value=!0},g=a=>{d.value=a,c.value=!0,e.markAsRead(a)},p=()=>{d.value=""};function y(a){return new Promise((t=>{a.readyState===WebSocket.OPEN?t():a.addEventListener("open",t,{once:!0})}))}return(0,o.sV)((async()=>{await P();const a=(0,v.mn)();await y(a);const t=e.chatList.filter((a=>"02"===a.status)).map((a=>a.chatroomId));t.forEach((a=>{const t={chatroomId:a,type:"REJOIN"};(0,v.wI)(t)}))})),{userId:a,nick:t,role:l,chatrooms:s,unreadCounts:n,chatroomId:d,isChatHistoryModalVisible:r,isModalVisible:c,openChatHistoryModal:_,openChatModal:g,resetChatroomId:p,ITEM_PER_PAGE:i,PAGE_PER_SECTION:u,pageStartIdx:E,onChangePage:I}}},_=l(1241);const g=(0,_.A)(P,[["render",u]]);var p=g}}]);
//# sourceMappingURL=940.c6147790.js.map